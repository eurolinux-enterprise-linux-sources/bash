--- a/lib/readline/history.c	2014-05-27 16:55:58.040214069 +0200
+++ b/lib/readline/history.c	2014-05-27 16:56:11.243204928 +0200
@@ -318,7 +318,7 @@ add_history_time (string)
 {
   HIST_ENTRY *hs;
 
-  if (string == 0)
+  if (string == 0 || history_length < 1)
     return;
   hs = the_history[history_length - 1];
   FREE (hs->timestamp);
